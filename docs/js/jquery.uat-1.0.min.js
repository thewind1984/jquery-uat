!function(t){t.fn.uat=function(e){function o(){return console.clear(),n.call(this),t.fn.uat.view.call(this),i.call(this),this}function i(){var o=this;t(e.obj).on("uatqueue",function(){r.call(o)})}function n(){var t=localStorage.getItem("uat_tests");"undefined"!=typeof t&&null!=t&&(t=JSON.parse(t),console.log("storedTests",t))}function s(t,e){return u.call(this,"unit",t,e)}function a(t,e){return u.call(this,"step",t,e)}function u(t,e,o){return c.push({type:t,name:e,args:o,passed:0,date:null,result:null,page:f}),this}function r(){if(h>=c.length)return resultation.call(this);p||(t.fn.uat.log.call(this,null,"--- page",f),p=new Date);var e=c[h];e.date=new Date,e.passed=1,t.fn.uat[e.type].call(this,e.name,e.args),h++,this.finish()}var l="console";e="object"==typeof e?e:{},e=t.extend({},{obj:null,step_by_step:!1,break_on_error:!1,timeout:0,output:l,debug:!1},e,{obj:this}),e.timeout=!isNaN(parseFloat(e.timeout))&&parseFloat(e.timeout)>0?parseFloat(e.timeout):0,e.output=-1==t.inArray(e.output,["console","window"])?l:e.output;var c=[],h=0,d=!1,f=location.href,p=!1,g=parseFloat(t("body").css("margin-bottom")),w=[];return sleep=function(t){var e=new Date,o=null;do o=new Date;while(t>o-e)},testFinished=function(o,i){return"unit"==o&&(d!==!1&&t.fn.uat.log.call(this,"info","break branch to root",!0),d=!1),c[h].result=i,e.timeout&&(t.fn.uat.log.call(this,null,"--- timeout",e.timeout+"sec"),sleep(1e3*e.timeout)),this},resultation=function(){var e={};t(c).each(function(){1==this.passed&&("undefined"==typeof e[this.result.type]&&(e[this.result.type]=0),e[this.result.type]++)});var o=[];return t.each(e,function(t,e){o.push(t+": "+e)}),t.fn.uat.log.call(this,null,"--- tests finished",o.join(", ")),this},getLastFoundObj=function(){return d},setLastFoundObj=function(t){d=t},getSettings=function(){return e},getBodyMarginBottom=function(){return g},addLogScope=function(t){w.push(t)},getLogScope=function(){return w},this.contains=function(t){return s.call(this,"contains",[t])},this.notContains=function(t){return s.call(this,"notContains",[t])},this.hasCookie=function(t){return s.call(this,"hasCookie",[t])},this.isObjVisible=function(t){return s.call(this,"isObjVisible",[t])},this.hasJsVariable=function(t){return s.call(this,"hasJsVariable",[t])},this.valueEqualsTo=function(t,e){return s.call(this,"valueEqualsTo",[t,e])},this.findObj=function(t){return a.call(this,"findObj",[t])},this.setCookie=function(t,e){return a.call(this,"setCookie",[t,e])},this.removeCookie=function(t){return a.call(this,"removeCookie",[t])},this.redirectTo=function(){},this.clickBy=function(t){return a.call(this,"clickBy",[t])},this.wait=function(t){return a.call(this,"wait",[t])},this.waitFor=function(){},this.fillIn=function(){},this.scrollToObj=function(t,e){return a.call(this,"scrollToObj",[t,e])},this.finish=function(){setTimeout(function(){t(e.obj).trigger("uatqueue")},p?1e3*e.timeout:50)},o.call(this)},t.fn.uat.unit=function(e,o){function i(e){var o=[];return t(e).each(function(){o.push(this.toString())}),o.join(", ")}var n=t.fn.uat.unit[e].apply(this,o);return t.fn.uat.log.call(this,n.type,e+" test: "+i(o),n.result),testFinished.call(this,"unit",n)},t.fn.uat.unit.contains=function(e){var o=(getLastFoundObj()||t(getSettings().obj)).find(e).length?!0:!1;return{type:o?"success":"error",result:o}},t.fn.uat.unit.notContains=function(e){var o=(getLastFoundObj()||t(getSettings().obj)).find(e).length?!1:!0;return{type:o?"success":"error",result:o}},t.fn.uat.unit.hasCookie=function(t){var e=new RegExp("(^|; )"+t.toString()+"=([^;$]*)","gi").exec(document.cookie);return{type:null!=e?"success":"error",result:null!=e?""!==e[2]?e[2]:"[EMPTY VALUE]":!1}},t.fn.uat.unit.isObjVisible=function(e){var o=t(e),i=o.offset().top,n=o.outerHeight(),s=i+n,a=t(window).outerHeight()+t(window).scrollTop(),u=a>i,r=u?a>=s?100:(n-(s-a))/n*100:0;return{type:u?"success":"error",result:(u?"true":"false")+" ("+r+"%)"}},t.fn.uat.unit.hasJsVariable=function(t){var e="undefined"!=typeof window[t];return{type:e?"success":"error",result:e?window[t].toString():!1}},t.fn.uat.unit.valueEqualsTo=function(e,o){var i=t(e);if(i.length){var n=i.attr("name")||null,s=n?t('[name="'+n+'"]'):[],a=n?s.length>1:!1,u=a?s:i,r=[];t(u).each(function(){var e=this.tagName.toLowerCase(),o=t(this).attr("type")||null;switch(e){case"input":-1!=t.inArray(o,["checkbox","radio"])?t(t(this).filter(":selected")).each(function(){r.push(this.value)}):r.push(this.value);case"button":case"textarea":r.push(this.value);break;case"select":t(t(this).find("option:selected")).each(function(){r.push(this.value)})}});var l=-1!=t.inArray(o,r);return{type:l?"success":"error",result:l}}return{type:"error",result:"object not found"}},t.fn.uat.step=function(e,o){function i(e){var o=[];return t(e).each(function(){o.push(this.toString())}),o.join(", ")}var n=t.fn.uat.unit[e].apply(this,o);return t.fn.uat.log.call(this,n.type,e+" test: "+i(o),n.result),testFinished.call(this,"step",n)},t.fn.uat.unit.findObj=function(e){return setLastFoundObj(t(getSettings().obj).find(e)),getLastFoundObj().length?{type:"success",result:!0}:{type:"warning",result:!1}},t.fn.uat.unit.setCookie=function(t,e){return document.cookie=t+"="+e.toString(),{type:"success",result:!0}},t.fn.uat.unit.removeCookie=function(t){return document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;",{type:"success",result:!0}},t.fn.uat.unit.scrollToObj=function(e,o){return t("html,body").scrollTop(t(e).offset().top+parseInt(o||0)),{type:"success",result:"scrollTop: "+t(window).scrollTop()}},t.fn.uat.unit.clickBy=function(e){return t(e).trigger("click"),{type:"success",result:!0}},t.fn.uat.unit.wait=function(t){return sleep.call(this,t),{type:"success",result:!0}},t.fn.uat.view=function(e,o){function i(){var e=t(r.window);e.css({bottom:"auto",top:e.position().top+"px"}).data({offset:e.position(),width:e.outerWidth(),height:e.outerHeight()})}function n(){t(r.window).css(h),i.call(this),t.fn.uat.storage.call(this,"set","window",null)}function s(){var e=t(r.window);t.fn.uat.storage.call(this,"set","window.position.left",e.data("offset").left+"px"),t.fn.uat.storage.call(this,"set","window.position.top",e.data("offset").top+"px"),t.fn.uat.storage.call(this,"set","window.dimension.width",e.data("width")+"px"),t.fn.uat.storage.call(this,"set","window.dimension.height",e.data("height")+"px")}function a(){if(t(r.window).length){var e=t(r.window);e.toggle()}else{var o={"-moz-user-select":"-moz-none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"},n={border:"1px solid #333",borderRadius:"4px",padding:"10px"},s={display:"flex",flexDirection:"row"},a={flexDirection:"column"},u={overflow:"auto",overflowX:"inherit"},c=t.fn.uat.storage.call(this,"get","window.position.left"),d=t.fn.uat.storage.call(this,"get","window.position.top"),f=t.fn.uat.storage.call(this,"get","window.dimension.width"),p=t.fn.uat.storage.call(this,"get","window.dimension.height"),e=t("<div>").attr({id:r.window.replace("#","")}).css(t.extend({},o,s,{position:"fixed",left:c||h.left,width:f||h.width,height:p||h.height,background:"#f1f1f1",color:"#000",fontSize:"12px",fontFamily:"Arial",fontWeight:"normal",fontStyle:"normal",padding:"10px",paddingTop:"16px",margin:0,boxSizing:"border-box",border:"2px solid #bbb",borderRadius:"6px",justifyContent:"space-between",opacity:l,minHeight:"100px",minWidth:"522px",transition:"opacity .3s"})).css("undefined"==typeof d?"bottom":"top",d||h.bottom).appendTo("body");i.call(this);{var g=(t("<div>").attr({id:r.mouseMover.replace("#",""),title:"Move UAT window by moving this bar","data-obj":"mover"}).css(t.extend({},n,{padding:0,position:"absolute",left:"2px",top:"2px",width:"calc(100% - 4px)",height:"0",borderWidth:"3px",background:"#333",cursor:"move"})).appendTo(e),t("<div>").attr({id:r.mouseResizer.replace("#",""),title:"Resize UAT window by moving this corner","data-obj":"resizer"}).css(t.extend({},n,{padding:0,position:"absolute",bottom:"2px",right:"2px",width:"20px",height:"20px",border:"3px solid #333",borderTop:0,borderLeft:0,cursor:"se-resize"})).appendTo(e),t("<div>").attr({id:r.tests.replace("#","")}).css(t.extend({},s,a,{width:"100%",marginRight:"10px"})).appendTo(e));t("<div>").attr({id:r.result.replace("#","")}).css(t.extend({},n,{height:"100%"},u)).appendTo(g),t("<div>").attr({id:r.help.replace("#","")}).css(t.extend({},n,{width:"100%",maxWidth:"300px"},u)).append('<div style="margin-bottom:10px;"><div style="float:right;"><b>Ctrl + Alt + U</b></div><div>Show / hide UAT window</div><div style="font-size:11px;margin-top:4px;">If init option <i>output</i> equals to <i>window</i>, it will be showen automatically.<div></div>').append('<div style="margin-bottom:10px;"><div style="float:right;"><b>Ctrl + Alt + R</b></div><div>Restore UAT window to initial state</div><div style="font-size:11px;margin-top:4px;">Full width, sticked to bottom of the window</div></div>').appendTo(e)}this.showResults("window")}}function u(){t("body").on("mouseover touchstart",r.window,function(){t(this).css("opacity",1)}).on("mouseout touchend",r.window,function(){t(this).css("opacity",l)}),t("body").on("mousedown touchstart",r.mouseMover+","+r.mouseResizer,function(e){c.mouseIsDown=!0,c.mouseObj=t(this),c.mousePosition.x="mousedown"==e.type?e.clientX:e.touches[0].clientX,c.mousePosition.y="mousedown"==e.type?e.clientY:e.touches[0].clientY,t(this).data("border",t(this).css("border-color")),t(this).css("border-color","red")}),t(window).on("keydown",function(t){if(t.ctrlKey&&t.altKey)switch(t.keyCode){case 85:a.call(c);break;case 82:n.call(c)}}).on("resize",function(){i(),s()}).on("mouseup touchend",function(){c.mouseIsDown=!1,null!==c.mouseObj&&c.mouseObj.css("border-color",c.mouseObj.data("border"))}).on("mousemove touchmove",function(e){if(c.mouseIsDown){var o="mousemove"==e.type?e.clientX:e.changedTouches[0].clientX,i="mousemove"==e.type?e.clientY:e.changedTouches[0].clientY,n={x:o-c.mousePosition.x,y:i-c.mousePosition.y};c.mousePosition.x=o,c.mousePosition.y=i;var a=t(r.window);switch(c.mouseObj.data("obj")){case"mover":a.data("offset",{left:a.data("offset").left+n.x,top:a.data("offset").top+n.y}),a.css({left:a.data("offset").left+"px",top:a.data("offset").top+"px"});break;case"resizer":a.data({width:a.data("width")+n.x,height:a.data("height")+n.y}),a.css({width:a.data("width")+"px",height:a.data("height")+"px"})}s()}})}var r={window:"#uat_window",tests:"#uat_block",help:"#uat_help",create:"#uat_create",result:"#uat_result",mouseMover:"#uat_mouse_mover",mouseResizer:"#uat_mouse_resize"},l=.3,c=this,h={width:"calc(100% - 20px)",height:"300px",left:"10px",top:"auto",bottom:"5px"};this.mouseIsDown=!1,this.mouseObj=null,this.mousePosition={x:0,y:0},this.showResults=function(e){t.fn.uat.log.call(this,e)},this.addLine=function(e,o,i){var n="uat_result_item_"+1e5*Math.random(),s=t(r.result);t("<div>").attr({style:i,id:n}).html(e+": "+o).appendTo(s),s.animate({scrollTop:s.prop("scrollHeight")},500)},this.init=function(){"window"===getSettings().output&&a.call(this),u()},this[e||"init"].apply(this,o||[])},t.fn.uat.log=function(e,o,i){function n(t,e,o){addLogScope([t,e,o]),s.call(this,t,e,o,getSettings().output)}function s(e,o,i,n){var s="color:"+i;o="undefined"==typeof o?"":o,"console"==n?console.log("%c"+e,s,o):t.fn.uat.view.call(this,"addLine",[e,o,s])}function a(t){for(var e=getLogScope(),o=0;o<e.length;o++){var i=e[o];i.push(t),s.apply(this,i)}}var u="black";switch(e){case"error":u="red";break;case"success":u="green";break;case"warning":u="orange";break;case"info":u="blue"}switch(e){case"window":case"console":a.call(this,e);break;default:n.call(this,("undefined"!=typeof e&&null!=e?"["+(new Date).toLocaleString()+"] ["+e.toUpperCase()+"] ":"")+o,i,u)}},t.fn.uat.storage=function(){var e={window:{position:{left:0,top:0},dimension:{width:0,height:0}}},o="uat_object";return this.set=function(o,i){var n=this.object()||e,s=this.prepareObjFromKey(o,i);this.object(t.extend(!0,{},n,s))},this.get=function(t){var e=this.object()||{};for(t=t.split(".");_key=t.shift();){if("undefined"==typeof e[_key]||null===e[_key])return;e=e[_key]}return e},this.object=function(t){if("undefined"==typeof t){var e=localStorage.getItem(o);return"undefined"==typeof e?e:JSON.parse(e)}localStorage.setItem(o,JSON.stringify(t))},this.prepareObjFromKey=function(t,e){t=t.split(".");for(var o=t.pop(),i=tempObj={};_key=t.shift();)tempObj=tempObj[_key]={};return tempObj[o]=e,i},"undefined"!=typeof arguments&&arguments.length?this[arguments[0]].apply(this,Array.from(arguments).slice(1)):void 0}}(jQuery);