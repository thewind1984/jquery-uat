!function(t){t.fn.uat=function(e){function n(){return console.clear(),o.call(this),t.fn.uat.view.call(this),i.call(this),this}function i(){var n=this;t(e.obj).on("uatqueue",function(){a.call(n)})}function o(){var t=localStorage.getItem("uat_tests");"undefined"!=typeof t&&null!=t&&(t=JSON.parse(t),console.log("storedTests",t))}function s(t,e){return r.call(this,"unit",t,e)}function u(t,e){return r.call(this,"step",t,e)}function r(t,e,n){return c.push({type:t,name:e,args:n,passed:0,date:null,result:null,page:h}),this}function a(){if(f>=c.length)return resultation.call(this);d||(t.fn.uat.log.call(this,null,"--- page",h),d=new Date);var e=c[f];e.date=new Date,e.passed=1,t.fn.uat[e.type].call(this,e.name,e.args),f++,this.finish()}var l="console";e="object"==typeof e?e:{},e=t.extend({},{obj:null,step_by_step:!1,break_on_error:!1,timeout:0,output:l,debug:!1},e,{obj:this}),e.timeout=!isNaN(parseFloat(e.timeout))&&parseFloat(e.timeout)>0?parseFloat(e.timeout):0,e.output=-1==t.inArray(e.output,["console","window"])?l:e.output;var c=[],f=0,p=!1,h=location.href,d=!1,g=parseFloat(t("body").css("margin-bottom")),w=[];return sleep=function(t){var e=new Date,n=null;do n=new Date;while(t>n-e)},testFinished=function(n,i){return"unit"==n&&(p!==!1&&t.fn.uat.log.call(this,"info","break branch to root",!0),p=!1),c[f].result=i,e.timeout&&(t.fn.uat.log.call(this,null,"--- timeout",e.timeout+"sec"),sleep(1e3*e.timeout)),this},resultation=function(){var e={};t(c).each(function(){1==this.passed&&("undefined"==typeof e[this.result.type]&&(e[this.result.type]=0),e[this.result.type]++)});var n=[];return t.each(e,function(t,e){n.push(t+": "+e)}),t.fn.uat.log.call(this,null,"--- tests finished",n.join(", ")),this},getLastFoundObj=function(){return p},setLastFoundObj=function(t){p=t},getSettings=function(){return e},getBodyMarginBottom=function(){return g},addLogScope=function(t){w.push(t)},getLogScope=function(){return w},this.contains=function(t){return s.call(this,"contains",[t])},this.notContains=function(t){return s.call(this,"notContains",[t])},this.hasCookie=function(t){return s.call(this,"hasCookie",[t])},this.isObjVisible=function(t){return s.call(this,"isObjVisible",[t])},this.hasJsVariable=function(t){return s.call(this,"hasJsVariable",[t])},this.valueEqualsTo=function(t,e){return s.call(this,"valueEqualsTo",[t,e])},this.findObj=function(t){return u.call(this,"findObj",[t])},this.setCookie=function(t,e){return u.call(this,"setCookie",[t,e])},this.removeCookie=function(t){return u.call(this,"removeCookie",[t])},this.redirectTo=function(){},this.clickBy=function(t){return u.call(this,"clickBy",[t])},this.wait=function(t){return u.call(this,"wait",[t])},this.waitFor=function(){},this.fillIn=function(){},this.scrollToObj=function(t,e){return u.call(this,"scrollToObj",[t,e])},this.finish=function(){setTimeout(function(){t(e.obj).trigger("uatqueue")},d?1e3*e.timeout:50)},n.call(this)},t.fn.uat.unit=function(e,n){function i(e){var n=[];return t(e).each(function(){n.push(this.toString())}),n.join(", ")}var o=t.fn.uat.unit[e].apply(this,n);return t.fn.uat.log.call(this,o.type,e+" test: "+i(n),o.result),testFinished.call(this,"unit",o)},t.fn.uat.unit.contains=function(e){var n=(getLastFoundObj()||t(getSettings().obj)).find(e).length?!0:!1;return{type:n?"success":"error",result:n}},t.fn.uat.unit.notContains=function(e){var n=(getLastFoundObj()||t(getSettings().obj)).find(e).length?!1:!0;return{type:n?"success":"error",result:n}},t.fn.uat.unit.hasCookie=function(t){var e=new RegExp("(^|; )"+t.toString()+"=([^;$]*)","gi").exec(document.cookie);return{type:null!=e?"success":"error",result:null!=e?""!==e[2]?e[2]:"[EMPTY VALUE]":!1}},t.fn.uat.unit.isObjVisible=function(e){var n=t(e),i=n.offset().top,o=n.outerHeight(),s=i+o,u=t(window).outerHeight()+t(window).scrollTop(),r=u>i,a=r?u>=s?100:(o-(s-u))/o*100:0;return{type:r?"success":"error",result:(r?"true":"false")+" ("+a+"%)"}},t.fn.uat.unit.hasJsVariable=function(t){var e="undefined"!=typeof window[t];return{type:e?"success":"error",result:e?window[t].toString():!1}},t.fn.uat.unit.valueEqualsTo=function(e,n){var i=t(e);if(i.length){var o=i.attr("name")||null,s=o?t('[name="'+o+'"]'):[],u=o?s.length>1:!1,r=u?s:i,a=[];t(r).each(function(){var e=this.tagName.toLowerCase(),n=t(this).attr("type")||null;switch(e){case"input":-1!=t.inArray(n,["checkbox","radio"])?t(t(this).filter(":selected")).each(function(){a.push(this.value)}):a.push(this.value);case"button":case"textarea":a.push(this.value);break;case"select":t(t(this).find("option:selected")).each(function(){a.push(this.value)})}});var l=-1!=t.inArray(n,a);return{type:l?"success":"error",result:l}}return{type:"error",result:"object not found"}},t.fn.uat.step=function(e,n){function i(e){var n=[];return t(e).each(function(){n.push(this.toString())}),n.join(", ")}var o=t.fn.uat.unit[e].apply(this,n);return t.fn.uat.log.call(this,o.type,e+" test: "+i(n),o.result),testFinished.call(this,"step",o)},t.fn.uat.unit.findObj=function(e){return setLastFoundObj(t(getSettings().obj).find(e)),getLastFoundObj().length?{type:"success",result:!0}:{type:"warning",result:!1}},t.fn.uat.unit.setCookie=function(t,e){return document.cookie=t+"="+e.toString(),{type:"success",result:!0}},t.fn.uat.unit.removeCookie=function(t){return document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;",{type:"success",result:!0}},t.fn.uat.unit.scrollToObj=function(e,n){return t("html,body").scrollTop(t(e).offset().top+parseInt(n||0)),{type:"success",result:"scrollTop: "+t(window).scrollTop()}},t.fn.uat.unit.clickBy=function(e){return t(e).trigger("click"),{type:"success",result:!0}},t.fn.uat.unit.wait=function(t){return sleep.call(this,t),{type:"success",result:!0}},t.fn.uat.view=function(e,n){function i(){if(t(s.window).length){var e=t(s.window);e.toggle()}else{var n={border:"1px solid #333",borderRadius:"4px",padding:"10px"},i={display:"flex",flexDirection:"row"},o={flexDirection:"column"},r=t.fn.uat.storage.call(this,"get","window.position.left"),a=t.fn.uat.storage.call(this,"get","window.position.top"),e=t("<div>").attr({id:s.window.replace("#","")}).css(t.extend({},i,{position:"fixed",left:r||"10px",width:"calc(100% - 20px)",height:"300px",background:"#f1f1f1",color:"#000",fontSize:"12px",fontFamily:"Arial",fontWeight:"normal",fontStyle:"normal",padding:"10px",margin:0,boxSizing:"border-box",border:"2px solid #bbb",borderRadius:"6px",justifyContent:"space-between",opacity:u,transition:"opacity .3s"})).css("undefined"==typeof a?"bottom":"top",a||"5px").appendTo("body");e.data("offset",e.position());{var l=(t("<div>").attr({id:s.mouseMover.replace("#",""),title:"Move UAT window by moving this bar","data-obj":"mover"}).css(t.extend({},n,{padding:0,position:"absolute",left:"2px",top:"2px",width:"calc(100% - 4px)",height:"4px",background:"#333",cursor:"move"})).appendTo(e),t("<div>").attr({id:s.mouseResizer.replace("#",""),title:"Resize UAT window by moving this corner","data-obj":"resizer"}).css(t.extend({},n,{padding:0,position:"absolute",bottom:"2px",right:"2px",width:"20px",height:"20px",border:"3px solid #333",borderTop:0,borderLeft:0,cursor:"se-resize"})).appendTo(e),t("<div>").attr({id:s.tests.replace("#","")}).css(t.extend({},i,o,{width:"100%",marginRight:"10px"})).appendTo(e));t("<div>").attr({id:s.result.replace("#","")}).css(t.extend({},n,{height:"100%",overflow:"auto",overflowX:"inherit"})).appendTo(l),t("<div>").attr({id:s.help.replace("#","")}).css(t.extend({},n,{width:"100%",maxWidth:"300px"})).html('<div style="margin-bottom:10px;"><div style="float:right;"><b>Ctrl + Alt + U</b></div><div>Show / hide UAT window</div><div style="font-size:11px;margin-top:4px;">If init option <i>output</i> equals to <i>window</i>, it will be showen automatically.<div></div>').appendTo(e)}this.showResults("window")}}function o(){t("body").on("mouseover",s.window,function(){t(this).css("opacity",1)}).on("mouseout",s.window,function(){t(this).css("opacity",u)}),t("body").on("mousedown",s.mouseMover+","+s.mouseResizer,function(e){r.mouseIsDown=!0,r.mouseObj=t(this).data("obj"),r.mousePosition.x=e.clientX,r.mousePosition.y=e.clientY}),t(window).on("keydown",function(t){t.ctrlKey&&t.altKey&&85===t.keyCode&&i.call(r)}).on("mouseup",function(){r.mouseIsDown=!1}).on("mousemove",function(e){if(r.mouseIsDown){var n={x:e.clientX-r.mousePosition.x,y:e.clientY-r.mousePosition.y};switch(r.mousePosition.x=e.clientX,r.mousePosition.y=e.clientY,r.mouseObj){case"mover":var i=t(s.window);i.data("offset",{left:i.data("offset").left+n.x,top:i.data("offset").top+n.y}),i.css({left:i.data("offset").left+"px",top:i.data("offset").top+"px"}),t.fn.uat.storage.call(this,"set","window.position.left",i.data("offset").left+"px"),t.fn.uat.storage.call(this,"set","window.position.top",i.data("offset").top+"px")}}})}var s={window:"#uat_window",tests:"#uat_block",help:"#uat_help",create:"#uat_create",result:"#uat_result",mouseMover:"#uat_mouse_mover",mouseResizer:"#uat_mouse_resize"},u=.5,r=this;this.mouseIsDown=!1,this.mouseObj=null,this.mousePosition={x:0,y:0},this.showResults=function(e){t.fn.uat.log.call(this,e)},this.addLine=function(e,n,i){var o="uat_result_item_"+1e5*Math.random(),u=t(s.result);t("<div>").attr({style:i,id:o}).html(e+": "+n).appendTo(u),u.animate({scrollTop:u.prop("scrollHeight")},500)},this.init=function(){"window"===getSettings().output&&i.call(this),o()},this[e||"init"].apply(this,n||[])},t.fn.uat.log=function(e,n,i){function o(t,e,n){addLogScope([t,e,n]),s.call(this,t,e,n,getSettings().output)}function s(e,n,i,o){var s="color:"+i;n="undefined"==typeof n?"":n,"console"==o?console.log("%c"+e,s,n):t.fn.uat.view.call(this,"addLine",[e,n,s])}function u(t){for(var e=getLogScope(),n=0;n<e.length;n++){var i=e[n];i.push(t),s.apply(this,i)}}var r="black";switch(e){case"error":r="red";break;case"success":r="green";break;case"warning":r="orange";break;case"info":r="blue"}switch(e){case"window":case"console":u.call(this,e);break;default:o.call(this,("undefined"!=typeof e&&null!=e?"["+(new Date).toLocaleString()+"] ["+e.toUpperCase()+"] ":"")+n,i,r)}},t.fn.uat.storage=function(){var e={window:{position:{left:0,top:0},dimension:{width:0,height:0}}},n="uat_object";return this.set=function(n,i){var o=this.object()||e,s=this.prepareObjFromKey(n,i);this.object(t.extend(!0,{},o,s))},this.get=function(t){var e=this.object()||{};for(t=t.split(".");_key=t.shift();){if("undefined"==typeof e[_key])return;e=e[_key]}return e},this.object=function(t){if("undefined"==typeof t){var e=localStorage.getItem(n);return"undefined"==typeof e?e:JSON.parse(e)}localStorage.setItem(n,JSON.stringify(t))},this.prepareObjFromKey=function(t,e){t=t.split(".");for(var n=t.pop(),i=tempObj={};_key=t.shift();)tempObj=tempObj[_key]={};return tempObj[n]=e,i},"undefined"!=typeof arguments&&arguments.length?this[arguments[0]].apply(this,Array.from(arguments).slice(1)):void 0}}(jQuery);