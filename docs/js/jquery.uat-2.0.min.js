!function(t){t.fn.uat=function(e){function i(){t("body").html('<iframe id="source_site_iframe" style="position:absolute;left:0;top:0;width:100%;height:100%;border:0;" src="'+location.href+'"></iframe>'),t.fn.uat.view.call(this)}function n(){var e=this;window.addEventListener("message",function(t){var e=JSON.parse(t.data),i=e.command||null;switch(i){case"runTest":var n=u(e.test);parent.postMessage(JSON.stringify({command:"receiveTestResult",test:e.test,result:n}),t.origin);break;case"receiveTestResult":var o=l(e.test,e.result);if(y=!1,x){resultation();break}if("string"!=typeof o)run();else switch(o){case"redirect":w=!0}break;case"frameReady":w&&(w=!1,run())}},!1),t("body").on("uatqueue",function(){r.call(e)})}function o(t,e){return a.call(this,"unit",t,e)}function s(t,e){return a.call(this,"step",t,e)}function a(t,e,i){return h.push({type:t,name:e,args:i||[],passed:0,date:null,result:null,page:g}),this}function r(){y=!0;var e=b?t.fn.uat.storage.call(this,"get","testNum")||0:0;if(e>=h.length)return resultation.call(this);b||(h=t.fn.uat.json.call(this,"load"),t.each(h,function(t){h[t].passed=0,h[t].date=null,h[t].result=null}));var i=h[e];if(i.page!=g||!b){if(!b){var n=t.fn.uat.view.call(this,"getSelector",["result"]);t(n).find('[id^="uat_result_item_"]').remove()}t.fn.uat.log.call(this,"page","--- page",i.page),g=i.page}b||(b=new Date),i.date=new Date,t("#source_site_iframe").get(0).contentWindow.postMessage(JSON.stringify({command:"runTest",test:i}),location.href)}function u(e){var i=t.fn.uat[e.type].call(this,e.name,e.args);return"unit"===e.type&&p!==!1&&(p=!1),i}function l(e,i){return t.fn.uat.log.call(this,i.type,e.name+" test: "+t.fn.uat.args.call(this,e.args),i.result),testFinished.call(this,e.type,i)}var c="console",d=t.extend({},{obj:"body",step_by_step:!1,break_on_error:!1,timeout:0,output:c,debug:!1},"object"==typeof e?e:{});d.timeout=!isNaN(parseFloat(d.timeout))&&parseFloat(d.timeout)>0?parseFloat(d.timeout):0,d.output=-1==t.inArray(d.output,["console","window"])?c:d.output;var f=window.top!=window.self,h=[],p=!1,g=location.href,m=[],b=!1,w=!1,v=!1,y=!1,x=!1;return getOptions=function(){return d},getLogScope=function(){return m},addLogScope=function(t){m.push(t)},getLastFoundObj=function(){return p},setLastFoundObj=function(t){p=t},togglePause=function(){v=!v},getIsPaused=function(){return v},getTestInProcess=function(){return y},finishAfterCurrent=function(){x=!0},isStarted=function(){return b},sleep=function(t){var e=new Date,i=null;do i=new Date;while(t>i-e)},testFinished=function(e,i){var n=t.fn.uat.storage.call(this,"get","testNum");return h[n].result=i,h[n].passed=1,t.fn.uat.storage.call(this,"set","tests",h),t.fn.uat.storage.call(this,"set","testNum",n+1),d.timeout&&(t.fn.uat.log.call(this,null,"--- timeout",d.timeout+"sec"),sleep(1e3*d.timeout)),i.action||this},resultation=function(){var e={};t(h).each(function(){1==this.passed&&("undefined"==typeof e[this.result.type]&&(e[this.result.type]=0),e[this.result.type]++)});var i=[];return t.each(e,function(t,e){i.push(t+": "+e)}),t.fn.uat.log.call(this,null,"--- tests finished",i.join(", ")),t.fn.uat.storage.call(this,"set","tests",null),t.fn.uat.storage.call(this,"set","settings",{}),t.fn.uat.storage.call(this,"set","testNum",0),p=!1,w=!1,v=!1,y=!1,x=!1,b=!1,this},this.contains=function(t){return o.call(this,"contains",[t])},this.notContains=function(t){return o.call(this,"notContains",[t])},this.hasCookie=function(t){return o.call(this,"hasCookie",[t])},this.isObjVisible=function(t){return o.call(this,"isObjVisible",[t])},this.hasJsVariable=function(t){return o.call(this,"hasJsVariable",[t])},this.valueEqualsTo=function(t,e){return o.call(this,"valueEqualsTo",[t,e])},this.findObj=function(t){return s.call(this,"findObj",[t])},this.setCookie=function(t,e){return s.call(this,"setCookie",[t,e])},this.removeCookie=function(t){return s.call(this,"removeCookie",[t])},this.redirectTo=function(e){if(e=t.trim(e),e!==g){var i=s.call(this,"redirectTo",[e]);return g=e,i}},this.clickBy=function(t){return s.call(this,"clickBy",[t])},this.wait=function(t){return s.call(this,"wait",[t])},this.waitFor=function(){},this.fillIn=function(){},this.scrollToObj=function(t,e){return s.call(this,"scrollToObj",[t,e])},this.finish=function(){t.fn.uat.storage.call(this,"set","tests",h),t.fn.uat.log.call(this,null,"--- detect tests..."),h.length?(t.fn.uat.log.call(this,null,"--- tests found",h.length),t.fn.uat.log.call(this,null,"--- generating JSON object..."),t.fn.uat.json.call(this,"prepare"),t.fn.uat.log.call(this,null,"--- JSON object is ready")):t.fn.uat.log.call(this,null,"--- no tests found")},run=function(){v||setTimeout(function(){t("body").trigger("uatqueue")},b?1e3*d.timeout:50)},n(),f?parent.postMessage(JSON.stringify({command:"frameReady"}),location.href):i(),this},t.fn.uat.unit=function(e,i){var n=t.fn.uat.unit[e].apply(this,i);return n},t.fn.uat.unit.contains=function(e){var i=(getLastFoundObj()||t(getOptions().obj)).find(e).length?!0:!1;return{type:i?"success":"error",result:i}},t.fn.uat.unit.notContains=function(e){var i=(getLastFoundObj()||t(getOptions().obj)).find(e).length?!1:!0;return{type:i?"success":"error",result:i}},t.fn.uat.unit.hasCookie=function(t){var e=new RegExp("(^|; )"+t.toString()+"=([^;$]*)","gi").exec(document.cookie);return{type:null!=e?"success":"error",result:null!=e?""!==e[2]?e[2]:"[EMPTY VALUE]":!1}},t.fn.uat.unit.isObjVisible=function(e){var i=t(e),n=i.length?i.offset().top:0,o=i.outerHeight(),s=n+o,a=t(window).outerHeight()+t(window).scrollTop(),r=i.length&&a>n,u=r?a>=s?100:(o-(s-a))/o*100:0;return{type:r?"success":"error",result:(r?"true":"false")+" ("+u+"%)"}},t.fn.uat.unit.hasJsVariable=function(t){var e="undefined"!=typeof window[t];return{type:e?"success":"error",result:e?window[t].toString():!1}},t.fn.uat.unit.valueEqualsTo=function(e,i){var n=t(e);if(n.length){var o=n.attr("name")||null,s=o?t('[name="'+o+'"]'):[],a=o?s.length>1:!1,r=a?s:n,u=[];t(r).each(function(){var e=this.tagName.toLowerCase(),i=t(this).attr("type")||null;switch(e){case"input":-1!=t.inArray(i,["checkbox","radio"])?t(t(this).filter(":selected")).each(function(){u.push(this.value)}):u.push(this.value);case"button":case"textarea":u.push(this.value);break;case"select":t(t(this).find("option:selected")).each(function(){u.push(this.value)})}});var l=-1!=t.inArray(i,u);return{type:l?"success":"error",result:l}}return{type:"error",result:"object not found"}},t.fn.uat.step=function(e,i){var n=t.fn.uat.unit[e].apply(this,i);return n},t.fn.uat.unit.findObj=function(e){return setLastFoundObj(t(getOptions().obj).find(e)),getLastFoundObj().length?{type:"success",result:!0}:{type:"warning",result:!1}},t.fn.uat.unit.setCookie=function(t,e){return document.cookie=t+"="+e.toString(),{type:"success",result:!0}},t.fn.uat.unit.removeCookie=function(t){return document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;",{type:"success",result:!0}},t.fn.uat.unit.scrollToObj=function(e,i){return t("html,body").scrollTop(t(e).offset().top+parseInt(i||0)),{type:"success",result:"scrollTop: "+t(window).scrollTop()}},t.fn.uat.unit.clickBy=function(e){return t(e).trigger("click"),{type:"success",result:!0}},t.fn.uat.unit.wait=function(t){return sleep.call(this,t),{type:"success",result:!0}},t.fn.uat.unit.redirectTo=function(t){return setTimeout(function(){location.href=t},100),{type:"success",result:!0,action:"redirect"}},t.fn.uat.args=function(e){var i=[];return t(e).each(function(){i.push(this.toString())}),i.join(", ")},t.fn.uat.view=function(e,i){function n(){var e=t(l.window);e.css({bottom:"auto",top:e.position().top+"px"}),s.call(this),e.data({offset:e.position(),width:e.outerWidth(),height:e.outerHeight()})}function o(){t(l.window).css(f),n.call(this),t.fn.uat.storage.call(this,"set","window",null)}function s(){var e=t(l.window),i=e.position(),n=document.body.clientWidth-e.outerWidth(),o=document.body.clientHeight-e.outerHeight();i.left<0?e.css("left",0):i.left>n&&e.css("left",n),i.top<0?e.css("top",0):i.top>o&&e.css("top",o)}function a(){var e=t(l.window);t.fn.uat.storage.call(this,"set","window.position.left",e.data("offset").left+"px"),t.fn.uat.storage.call(this,"set","window.position.top",e.data("offset").top+"px"),t.fn.uat.storage.call(this,"set","window.dimension.width",e.data("width")+"px"),t.fn.uat.storage.call(this,"set","window.dimension.height",e.data("height")+"px")}function r(){if(t(l.window).length){var e=t(l.window);e.toggle()}else{var i=t.fn.uat.storage.call(this,"get","window.position.left"),o=t.fn.uat.storage.call(this,"get","window.position.top"),s=t.fn.uat.storage.call(this,"get","window.dimension.width"),a=t.fn.uat.storage.call(this,"get","window.dimension.height"),e=t("<div>").attr({id:l.window.replace("#","")}).css(t.extend({},h,g,{position:"fixed",left:i||f.left,width:s||f.width,height:a||f.height,background:"#f1f1f1",color:"#000",fontSize:"12px",fontFamily:"Arial",fontWeight:"normal",fontStyle:"normal",padding:"10px",paddingTop:"16px",margin:0,boxSizing:"border-box",border:"2px solid #bbb",borderRadius:"6px",justifyContent:"space-between",opacity:c,minHeight:"100px",minWidth:"522px",transition:"opacity .3s"})).css("undefined"==typeof o?"bottom":"top",o||f.bottom).appendTo("body");n.call(this);var r=(t("<div>").attr({id:l.mouseMover.replace("#",""),title:"Move UAT window by moving this bar","data-obj":"mover"}).css(t.extend({},p,{padding:0,position:"absolute",left:"2px",top:"2px",width:"calc(100% - 4px)",height:"0",borderWidth:"3px",background:"#333",cursor:"move"})).appendTo(e),t("<div>").attr({id:l.mouseResizer.replace("#",""),title:"Resize UAT window by moving this corner","data-obj":"resizer"}).css(t.extend({},p,{padding:0,position:"absolute",bottom:"2px",right:"2px",width:"20px",height:"20px",border:"3px solid #333",borderTop:0,borderLeft:0,cursor:"se-resize"})).appendTo(e),t("<div>").attr({id:l.tests.replace("#","")}).css(t.extend({},g,m,{width:"100%",marginRight:"10px",zIndex:1})).appendTo(e)),u=t("<div>").css(t.extend({},g,{minHeight:"18px",height:"18px"})).appendTo(r),d=(t("<div>").attr("data-tab",l.result).css(t.extend({},p,w,v,y)).text("Console").appendTo(u),t("<div>").attr("data-tab",l.create).css(t.extend({},p,w)).text("Setup").appendTo(u),t("<div>").attr({id:l.result.replace("#",""),"data-tab-content":""}).css(t.extend({},p,{height:"100%",borderTopLeftRadius:0},b)).appendTo(r),t("<div>").attr({id:l.create.replace("#",""),"data-tab-content":""}).css(t.extend({},p,{height:"100%",borderTopLeftRadius:0},b)).hide().appendTo(r)),k=(t("<textarea>").attr({id:l.jsonArea.replace("#",""),readonly:!0}).css(t.extend({},p,{background:"#fff",height:"80px",minHeight:"60px",width:"100%",maxWidth:"100%",minWidth:"100%",outline:"none",padding:0,margin:0,fontSize:"11px",lineHeight:"100%"})).appendTo(d),t("<div>").attr({id:l.help.replace("#","")}).css(t.extend({},p,{width:"100%",maxWidth:"300px"},b)).append('<div style="margin-bottom:10px;"><div style="float:right;"><b data-uat_keycode="U">Ctrl + Alt + U</b></div><div>Show / hide UAT window</div><div style="font-size:11px;margin-top:4px;">If init option <i>output</i> equals to <i>window</i>, it will be showen automatically.<div></div>').append('<div style="margin-bottom:10px;"><div style="float:right;"><b data-uat_keycode="R">Ctrl + Alt + R</b></div><div>Restore UAT window to initial state</div><div style="font-size:11px;margin-top:4px;">Full width, sticked to bottom of the window</div></div>').append('<div style="margin-bottom:10px;"><div style="float:right;"><b data-uat_keycode="G">Ctrl + Alt + G</b></div><div>Start tests</div></div>').append('<div style="margin-bottom:10px;"><div style="float:right;"><b data-uat_keycode="P">Ctrl + Alt + P</b></div><div>Pause / resume tests</div></div>').append('<div style="margin-bottom:10px;"><div style="float:right;"><b data-uat_keycode="S">Ctrl + Alt + S</b></div><div>Stop tests</div></div>').appendTo(e));k.find("b").css(x),this.showResults("window")}}function u(){t("body").on("mouseover touchstart",l.window,function(){t(this).css("opacity",1)}).on("mouseout touchend",l.window,function(){t(this).css("opacity",c)}).on("mousedown touchstart",l.mouseMover+","+l.mouseResizer,function(e){d.mouseIsDown=!0,d.mouseObj=t(this),d.mousePosition.x="mousedown"==e.type?e.clientX:e.touches[0].clientX,d.mousePosition.y="mousedown"==e.type?e.clientY:e.touches[0].clientY,t(this).data("border",t(this).css("border-color")),t(this).css("border-color","red")}).on("click","[data-tab]",function(e){e.preventDefault(),t(this).siblings("[data-tab]").css(t.extend({},p,w)),t(this).css(t.extend({},p,w,v)),t(this).parent().find("[data-tab]").eq(0).css(y);var i=t("[data-tab-content]"+t(this).data("tab"));i.show().siblings("[data-tab-content]").hide()}).on("click",l.jsonArea,function(){var e=t(this).get(0);e.focus(),e.select()}).on("click","[data-uat_keycode]",function(e){var i="CtrlAlt"+t(this).data("uat_keycode");d[i](e)}),t(window).on("keydown",function(t){if(t.ctrlKey&&t.altKey)switch(t.keyCode){case 85:this.CtrlAltU(t);break;case 82:this.CtrlAltR(t);break;case 83:this.CtrlAltS(t);break;case 71:this.CtrlAltG(t);break;case 80:this.CtrlAltP(t)}}).on("resize",function(){s(),n(),a()}).on("mouseup touchend",function(){d.mouseIsDown=!1,null!==d.mouseObj&&d.mouseObj.css("border-color",d.mouseObj.data("border"))}).on("mousemove touchmove",function(e){if(d.mouseIsDown){var i="mousemove"==e.type?e.clientX:e.changedTouches[0].clientX,n="mousemove"==e.type?e.clientY:e.changedTouches[0].clientY,o={x:i-d.mousePosition.x,y:n-d.mousePosition.y};d.mousePosition.x=i,d.mousePosition.y=n;var s=t(l.window);switch(d.mouseObj.data("obj")){case"mover":var r=s.data("offset").left+o.x,u=s.data("offset").top+o.y;if(0>r||r>document.body.clientWidth-s.outerWidth()||0>u||u>document.body.clientHeight-s.outerHeight())break;s.data("offset",{left:r,top:u}),s.css({left:s.data("offset").left+"px",top:s.data("offset").top+"px"});break;case"resizer":s.data({width:s.data("width")+o.x,height:s.data("height")+o.y}),s.css({width:s.data("width")+"px",height:s.data("height")+"px"})}a()}})}var l={window:"#uat_window",tests:"#uat_block",help:"#uat_help",create:"#uat_create",result:"#uat_result",mouseMover:"#uat_mouse_mover",mouseResizer:"#uat_mouse_resize",jsonArea:"#uat_json_area"},c=.3,d=this,f={width:"calc(100% - 20px)",height:"300px",left:"10px",top:"auto",bottom:"5px"};this.mouseIsDown=!1,this.mouseObj=null,this.mousePosition={x:0,y:0},this.getSelector=function(t){return l[t]};var h={"-moz-user-select":"-moz-none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"},p={border:"1px solid #333",borderRadius:"4px",padding:"10px"},g={display:"flex",flexDirection:"row"},m={flexDirection:"column"},b={overflow:"auto",overflowX:"inherit"},w={borderBottomLeftRadius:0,borderBottomRightRadius:0,padding:"3px 6px 8px",cursor:"pointer",position:"relative",top:"1px",marginTop:0,borderLeftWidth:0,fontSize:"11px",lineHeight:"100%",zIndex:0},v={borderBottomColor:"#efefef",zIndex:2,top:0,marginTop:"-2px",paddingTop:"6px",paddingBottom:"13px"},y={borderLeftWidth:"1px"},x={cursor:"pointer",background:"#aaa",color:"#fff",fontWeight:"normal",padding:"2px 5px",borderRadius:"4px"};return this.CtrlAltU=function(t){t.preventDefault(),r.call(d)},this.CtrlAltR=function(t){t.preventDefault(),o.call(d)},this.CtrlAltS=function(t){t.preventDefault(),getIsPaused()?resultation():isStarted()&&finishAfterCurrent()},this.CtrlAltG=function(e){return e.preventDefault(),getIsPaused()?void t.fn.uat.log.call(this,null,"Tests are on the PAUSE. Use CTRL + ALT + P to resume the queue."):void run()},this.CtrlAltP=function(t){t.preventDefault(),isStarted()&&(togglePause(),getIsPaused()||getTestInProcess()||run())},this.showResults=function(e){t.fn.uat.log.call(this,e)},this.addLine=function(e,i,n){var o="uat_result_item_"+1e5*Math.random(),s=t(l.result);t("<div>").attr({style:n,id:o}).html(e+": "+i).appendTo(s),s.animate({scrollTop:s.prop("scrollHeight")},200)},this.init=function(){"window"===getOptions().output&&r.call(this),u()},this[e||"init"].apply(this,i||[])},t.fn.uat.storage=function(){var e={window:{position:{left:0,top:0},dimension:{width:0,height:0}},settings:{},tests:[],testNum:0},i="uat_object";return this.set=function(i,n){var o=this.object()||e,s=this.prepareObjFromKey(i,n);this.object(t.extend(!0,{},o,s))},this.get=function(t){var e=this.object()||{};for(t=t.split(".");_key=t.shift();){if("undefined"==typeof e[_key]||null===e[_key])return;e=e[_key]}return e},this.object=function(t){if("undefined"==typeof t){var e=localStorage.getItem(i);return"undefined"==typeof e?e:JSON.parse(e)}localStorage.setItem(i,JSON.stringify(t))},this.prepareObjFromKey=function(t,e){t=t.split(".");for(var i=t.pop(),n=tempObj={};_key=t.shift();)tempObj=tempObj[_key]={};return tempObj[i]=e,n},"undefined"!=typeof arguments&&arguments.length?this[arguments[0]].apply(this,Array.from(arguments).slice(1)):void 0},t.fn.uat.log=function(e,i,n){function o(t,e,i){addLogScope([t,e,i]),s.call(this,t,e,i,getOptions().output)}function s(e,i,n,o){var s="color:"+n+";background:"+u;i="undefined"==typeof i?"":i,"console"==o?console.log("%c"+e,s,i):t.fn.uat.view.call(this,"addLine",[e,i,s])}function a(t){for(var e=getLogScope(),i=0;i<e.length;i++){var n=e[i];n.push(t),s.apply(this,n)}}var r="black",u="transparent";switch(e){case"error":r="red";break;case"success":r="green";break;case"warning":r="orange";break;case"info":r="blue";case"page":r="white",u="black"}switch(e){case"window":case"console":a.call(this,e);break;default:o.call(this,("undefined"!=typeof e&&null!=e?"["+(new Date).toLocaleString()+"] ["+e.toUpperCase()+"] ":"")+i,n,r)}},t.fn.uat.json=function(e){function i(){var e=t.fn.uat.storage.call(this,"get","tests"),i=t.fn.uat.view.call(this,"getSelector",["jsonArea"]);t.each(e,function(t){delete e[t].passed,delete e[t].date,delete e[t].result}),t(i).text(JSON.stringify(e))}function n(){var e=t.fn.uat.view.call(this,"getSelector",["jsonArea"]),i=JSON.parse(t(e).val());return t.fn.uat.storage.call(this,"set","tests",i),i}var o={prepare:i,load:n};return o[e].call(this)}}(jQuery);