!function(t){t.fn.uat=function(e){function o(){return console.clear(),n.call(this),t.fn.uat.view.call(this),i.call(this),this}function i(){var o=this;t(e.obj).on("uatqueue",function(){r.call(o)})}function n(){var t=localStorage.getItem("uat_tests");"undefined"!=typeof t&&null!=t&&(t=JSON.parse(t),console.log("storedTests",t))}function s(t,e){return a.call(this,"unit",t,e)}function u(t,e){return a.call(this,"step",t,e)}function a(t,e,o){return c.push({type:t,name:e,args:o,passed:0,date:null,result:null,page:f}),this}function r(){if(d>=c.length)return resultation.call(this);p||(t.fn.uat.log.call(this,null,"--- page",f),p=new Date);var e=c[d];e.date=new Date,e.passed=1,t.fn.uat[e.type].call(this,e.name,e.args),d++,this.finish()}var l="console";e="object"==typeof e?e:{},e=t.extend({},{obj:null,step_by_step:!1,break_on_error:!1,timeout:0,output:l,debug:!1},e,{obj:this}),e.timeout=!isNaN(parseFloat(e.timeout))&&parseFloat(e.timeout)>0?parseFloat(e.timeout):0,e.output=-1==t.inArray(e.output,["console","window"])?l:e.output;var c=[],d=0,h=!1,f=location.href,p=!1,g=parseFloat(t("body").css("margin-bottom")),w=[];return sleep=function(t){var e=new Date,o=null;do o=new Date;while(t>o-e)},testFinished=function(o,i){return"unit"==o&&(h!==!1&&t.fn.uat.log.call(this,"info","break branch to root",!0),h=!1),c[d].result=i,e.timeout&&(t.fn.uat.log.call(this,null,"--- timeout",e.timeout+"sec"),sleep(1e3*e.timeout)),this},resultation=function(){var e={};t(c).each(function(){1==this.passed&&("undefined"==typeof e[this.result.type]&&(e[this.result.type]=0),e[this.result.type]++)});var o=[];return t.each(e,function(t,e){o.push(t+": "+e)}),t.fn.uat.log.call(this,null,"--- tests finished",o.join(", ")),this},getLastFoundObj=function(){return h},setLastFoundObj=function(t){h=t},getSettings=function(){return e},getBodyMarginBottom=function(){return g},addLogScope=function(t){w.push(t)},getLogScope=function(){return w},this.contains=function(t){return s.call(this,"contains",[t])},this.notContains=function(t){return s.call(this,"notContains",[t])},this.hasCookie=function(t){return s.call(this,"hasCookie",[t])},this.isObjVisible=function(t){return s.call(this,"isObjVisible",[t])},this.hasJsVariable=function(t){return s.call(this,"hasJsVariable",[t])},this.valueEqualsTo=function(t,e){return s.call(this,"valueEqualsTo",[t,e])},this.findObj=function(t){return u.call(this,"findObj",[t])},this.setCookie=function(t,e){return u.call(this,"setCookie",[t,e])},this.removeCookie=function(t){return u.call(this,"removeCookie",[t])},this.redirectTo=function(){},this.clickBy=function(t){return u.call(this,"clickBy",[t])},this.wait=function(t){return u.call(this,"wait",[t])},this.waitFor=function(){},this.fillIn=function(){},this.scrollToObj=function(t,e){return u.call(this,"scrollToObj",[t,e])},this.finish=function(){setTimeout(function(){t(e.obj).trigger("uatqueue")},p?1e3*e.timeout:50)},o.call(this)},t.fn.uat.unit=function(e,o){function i(e){var o=[];return t(e).each(function(){o.push(this.toString())}),o.join(", ")}var n=t.fn.uat.unit[e].apply(this,o);return t.fn.uat.log.call(this,n.type,e+" test: "+i(o),n.result),testFinished.call(this,"unit",n)},t.fn.uat.unit.contains=function(e){var o=(getLastFoundObj()||t(getSettings().obj)).find(e).length?!0:!1;return{type:o?"success":"error",result:o}},t.fn.uat.unit.notContains=function(e){var o=(getLastFoundObj()||t(getSettings().obj)).find(e).length?!1:!0;return{type:o?"success":"error",result:o}},t.fn.uat.unit.hasCookie=function(t){var e=new RegExp("(^|; )"+t.toString()+"=([^;$]*)","gi").exec(document.cookie);return{type:null!=e?"success":"error",result:null!=e?""!==e[2]?e[2]:"[EMPTY VALUE]":!1}},t.fn.uat.unit.isObjVisible=function(e){var o=t(e),i=o.offset().top,n=o.outerHeight(),s=i+n,u=t(window).outerHeight()+t(window).scrollTop(),a=u>i,r=a?u>=s?100:(n-(s-u))/n*100:0;return{type:a?"success":"error",result:(a?"true":"false")+" ("+r+"%)"}},t.fn.uat.unit.hasJsVariable=function(t){var e="undefined"!=typeof window[t];return{type:e?"success":"error",result:e?window[t].toString():!1}},t.fn.uat.unit.valueEqualsTo=function(e,o){var i=t(e);if(i.length){var n=i.attr("name")||null,s=n?t('[name="'+n+'"]'):[],u=n?s.length>1:!1,a=u?s:i,r=[];t(a).each(function(){var e=this.tagName.toLowerCase(),o=t(this).attr("type")||null;switch(e){case"input":-1!=t.inArray(o,["checkbox","radio"])?t(t(this).filter(":selected")).each(function(){r.push(this.value)}):r.push(this.value);case"button":case"textarea":r.push(this.value);break;case"select":t(t(this).find("option:selected")).each(function(){r.push(this.value)})}});var l=-1!=t.inArray(o,r);return{type:l?"success":"error",result:l}}return{type:"error",result:"object not found"}},t.fn.uat.step=function(e,o){function i(e){var o=[];return t(e).each(function(){o.push(this.toString())}),o.join(", ")}var n=t.fn.uat.unit[e].apply(this,o);return t.fn.uat.log.call(this,n.type,e+" test: "+i(o),n.result),testFinished.call(this,"step",n)},t.fn.uat.unit.findObj=function(e){return setLastFoundObj(t(getSettings().obj).find(e)),getLastFoundObj().length?{type:"success",result:!0}:{type:"warning",result:!1}},t.fn.uat.unit.setCookie=function(t,e){return document.cookie=t+"="+e.toString(),{type:"success",result:!0}},t.fn.uat.unit.removeCookie=function(t){return document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;",{type:"success",result:!0}},t.fn.uat.unit.scrollToObj=function(e,o){return t("html,body").scrollTop(t(e).offset().top+parseInt(o||0)),{type:"success",result:"scrollTop: "+t(window).scrollTop()}},t.fn.uat.unit.clickBy=function(e){return t(e).trigger("click"),{type:"success",result:!0}},t.fn.uat.unit.wait=function(t){return sleep.call(this,t),{type:"success",result:!0}},t.fn.uat.view=function(e,o){function i(){var e=t(l.window);e.css({bottom:"auto",top:e.position().top+"px"}),s.call(this),e.data({offset:e.position(),width:e.outerWidth(),height:e.outerHeight()})}function n(){t(l.window).css(h),i.call(this),t.fn.uat.storage.call(this,"set","window",null)}function s(){var e=t(l.window),o=e.position(),i=document.body.clientWidth-e.outerWidth(),n=document.body.clientHeight-e.outerHeight();o.left<0?e.css("left",0):o.left>i&&e.css("left",i),o.top<0?e.css("top",0):o.top>n&&e.css("top",n)}function u(){var e=t(l.window);t.fn.uat.storage.call(this,"set","window.position.left",e.data("offset").left+"px"),t.fn.uat.storage.call(this,"set","window.position.top",e.data("offset").top+"px"),t.fn.uat.storage.call(this,"set","window.dimension.width",e.data("width")+"px"),t.fn.uat.storage.call(this,"set","window.dimension.height",e.data("height")+"px")}function a(){if(t(l.window).length){var e=t(l.window);e.toggle()}else{var o={"-moz-user-select":"-moz-none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"},n={border:"1px solid #333",borderRadius:"4px",padding:"10px"},s={display:"flex",flexDirection:"row"},u={flexDirection:"column"},a={overflow:"auto",overflowX:"inherit"},r=t.fn.uat.storage.call(this,"get","window.position.left"),d=t.fn.uat.storage.call(this,"get","window.position.top"),f=t.fn.uat.storage.call(this,"get","window.dimension.width"),p=t.fn.uat.storage.call(this,"get","window.dimension.height"),e=t("<div>").attr({id:l.window.replace("#","")}).css(t.extend({},o,s,{position:"fixed",left:r||h.left,width:f||h.width,height:p||h.height,background:"#f1f1f1",color:"#000",fontSize:"12px",fontFamily:"Arial",fontWeight:"normal",fontStyle:"normal",padding:"10px",paddingTop:"16px",margin:0,boxSizing:"border-box",border:"2px solid #bbb",borderRadius:"6px",justifyContent:"space-between",opacity:c,minHeight:"100px",minWidth:"522px",transition:"opacity .3s"})).css("undefined"==typeof d?"bottom":"top",d||h.bottom).appendTo("body");i.call(this);{var g=(t("<div>").attr({id:l.mouseMover.replace("#",""),title:"Move UAT window by moving this bar","data-obj":"mover"}).css(t.extend({},n,{padding:0,position:"absolute",left:"2px",top:"2px",width:"calc(100% - 4px)",height:"0",borderWidth:"3px",background:"#333",cursor:"move"})).appendTo(e),t("<div>").attr({id:l.mouseResizer.replace("#",""),title:"Resize UAT window by moving this corner","data-obj":"resizer"}).css(t.extend({},n,{padding:0,position:"absolute",bottom:"2px",right:"2px",width:"20px",height:"20px",border:"3px solid #333",borderTop:0,borderLeft:0,cursor:"se-resize"})).appendTo(e),t("<div>").attr({id:l.tests.replace("#","")}).css(t.extend({},s,u,{width:"100%",marginRight:"10px"})).appendTo(e));t("<div>").attr({id:l.result.replace("#","")}).css(t.extend({},n,{height:"100%"},a)).appendTo(g),t("<div>").attr({id:l.help.replace("#","")}).css(t.extend({},n,{width:"100%",maxWidth:"300px"},a)).append('<div style="margin-bottom:10px;"><div style="float:right;"><b>Ctrl + Alt + U</b></div><div>Show / hide UAT window</div><div style="font-size:11px;margin-top:4px;">If init option <i>output</i> equals to <i>window</i>, it will be showen automatically.<div></div>').append('<div style="margin-bottom:10px;"><div style="float:right;"><b>Ctrl + Alt + R</b></div><div>Restore UAT window to initial state</div><div style="font-size:11px;margin-top:4px;">Full width, sticked to bottom of the window</div></div>').appendTo(e)}this.showResults("window")}}function r(){t("body").on("mouseover touchstart",l.window,function(){t(this).css("opacity",1)}).on("mouseout touchend",l.window,function(){t(this).css("opacity",c)}),t("body").on("mousedown touchstart",l.mouseMover+","+l.mouseResizer,function(e){d.mouseIsDown=!0,d.mouseObj=t(this),d.mousePosition.x="mousedown"==e.type?e.clientX:e.touches[0].clientX,d.mousePosition.y="mousedown"==e.type?e.clientY:e.touches[0].clientY,t(this).data("border",t(this).css("border-color")),t(this).css("border-color","red")}),t(window).on("keydown",function(t){if(t.ctrlKey&&t.altKey)switch(t.keyCode){case 85:a.call(d);break;case 82:n.call(d)}}).on("resize",function(){s(),i(),u()}).on("mouseup touchend",function(){d.mouseIsDown=!1,null!==d.mouseObj&&d.mouseObj.css("border-color",d.mouseObj.data("border"))}).on("mousemove touchmove",function(e){if(d.mouseIsDown){var o="mousemove"==e.type?e.clientX:e.changedTouches[0].clientX,i="mousemove"==e.type?e.clientY:e.changedTouches[0].clientY,n={x:o-d.mousePosition.x,y:i-d.mousePosition.y};d.mousePosition.x=o,d.mousePosition.y=i;var s=t(l.window);switch(d.mouseObj.data("obj")){case"mover":var a=s.data("offset").left+n.x,r=s.data("offset").top+n.y;if(0>a||a>document.body.clientWidth-s.outerWidth()||0>r||r>document.body.clientHeight-s.outerHeight())break;s.data("offset",{left:a,top:r}),s.css({left:s.data("offset").left+"px",top:s.data("offset").top+"px"});break;case"resizer":s.data({width:s.data("width")+n.x,height:s.data("height")+n.y}),s.css({width:s.data("width")+"px",height:s.data("height")+"px"})}u()}})}var l={window:"#uat_window",tests:"#uat_block",help:"#uat_help",create:"#uat_create",result:"#uat_result",mouseMover:"#uat_mouse_mover",mouseResizer:"#uat_mouse_resize"},c=.3,d=this,h={width:"calc(100% - 20px)",height:"300px",left:"10px",top:"auto",bottom:"5px"};this.mouseIsDown=!1,this.mouseObj=null,this.mousePosition={x:0,y:0},this.showResults=function(e){t.fn.uat.log.call(this,e)},this.addLine=function(e,o,i){var n="uat_result_item_"+1e5*Math.random(),s=t(l.result);t("<div>").attr({style:i,id:n}).html(e+": "+o).appendTo(s),s.animate({scrollTop:s.prop("scrollHeight")},500)},this.init=function(){"window"===getSettings().output&&a.call(this),r()},this[e||"init"].apply(this,o||[])},t.fn.uat.log=function(e,o,i){function n(t,e,o){addLogScope([t,e,o]),s.call(this,t,e,o,getSettings().output)}function s(e,o,i,n){var s="color:"+i;o="undefined"==typeof o?"":o,"console"==n?console.log("%c"+e,s,o):t.fn.uat.view.call(this,"addLine",[e,o,s])}function u(t){for(var e=getLogScope(),o=0;o<e.length;o++){var i=e[o];i.push(t),s.apply(this,i)}}var a="black";switch(e){case"error":a="red";break;case"success":a="green";break;case"warning":a="orange";break;case"info":a="blue"}switch(e){case"window":case"console":u.call(this,e);break;default:n.call(this,("undefined"!=typeof e&&null!=e?"["+(new Date).toLocaleString()+"] ["+e.toUpperCase()+"] ":"")+o,i,a)}},t.fn.uat.storage=function(){var e={window:{position:{left:0,top:0},dimension:{width:0,height:0}}},o="uat_object";return this.set=function(o,i){var n=this.object()||e,s=this.prepareObjFromKey(o,i);this.object(t.extend(!0,{},n,s))},this.get=function(t){var e=this.object()||{};for(t=t.split(".");_key=t.shift();){if("undefined"==typeof e[_key]||null===e[_key])return;e=e[_key]}return e},this.object=function(t){if("undefined"==typeof t){var e=localStorage.getItem(o);return"undefined"==typeof e?e:JSON.parse(e)}localStorage.setItem(o,JSON.stringify(t))},this.prepareObjFromKey=function(t,e){t=t.split(".");for(var o=t.pop(),i=tempObj={};_key=t.shift();)tempObj=tempObj[_key]={};return tempObj[o]=e,i},"undefined"!=typeof arguments&&arguments.length?this[arguments[0]].apply(this,Array.from(arguments).slice(1)):void 0}}(jQuery);